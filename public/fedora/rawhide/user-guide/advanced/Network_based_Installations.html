<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setting Up an Installation Server :: Local Preview</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../../../_/css/site.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar" style="">
    <div class="navbar-brand">
      <a class="navbar-item" href="../../../..">
        <img src="../../../../_/img/docs_logo.png" style="height:40px">
      </a>
      <!-- We don't have anything in the menu, but the burger still appears
           on mobile devices. So let's remove it. -->
      <!--<button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>-->
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        
      </div>
    </div>
  </nav>
</header>
<div class="main-wrapper">
<div class="navigation-container" data-component="fedora" data-version="rawhide">
  <aside class="navigation" role="navigation">
    <div class="panels">
<div class="navigation-explore is-active" data-panel="explore">
  <div class="context">
    <span class="title">fedora</span>
    <span class="version">rawhide</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">fedora</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../../index.html">rawhide</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
  <main class="main" role="main">
<div class="toolbar" role="navigation">
  <button class="navigation-toggle"></button>
<nav class="crumbs" role="navigation" aria-label="breadcrumbs">
  
  <ul>
      <li class="crumb HO"><a href="../index.html">Home</a></li>
    <li class="crumb HO"><a href="../../index.html">fedora</a></li>
  </ul>
  
</nav>
  <div class="edit-this-page"><a href="https://github.com/Rasbats/opencpn_plugins_docs/edit/main/modules/user-guide/pages/advanced/Network_based_Installations.adoc">Edit this Page</a></div>
</div>
<article class="doc">
<h1>Setting Up an Installation Server</h1>
<div id="preamble">
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This appendix is intended for users with previous Linux experience. If you are a new user, you may want to install using minimal boot media or the distribution DVD instead.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-overview"><a class="anchor" href="#pxe-overview"></a>PXE Installation Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Preboot Execution Environment, or PXE, is a techonology that allows computers to boot directly from resources provided over the network. Installing Fedora over the network means you don&#8217;t have to create media, and you can install to multiple computers or virtual machine simultaneously. The process involves a number of components and features working together to provide the resources required.</p>
</div>
<div class="paragraph">
<div class="title">PXE-capable computer</div>
<p>Most modern computers have the capability to network boot. Typically, a function key pressed during boot will bring up a boot selection menu. In environments designed for unattended administration, systems will often be configured to first attempt booting from the network, then boot from local storage, and the installation server is configured to only offer the installation when required. Your computer&#8217;s manual will provide specific instructions on setting boot priorities.</p>
</div>
<div class="paragraph">
<div class="title">DHCP Server</div>
<p>When a system requests an address during network booting, the DHCP server also provides the location of files to boot. A network should have only one DHCP server.</p>
</div>
<div class="paragraph">
<div class="title">TFTP Server</div>
<p>Because the pre-boot environment is very simple, files must be provided in a very simple way. Trivial File Transfer Protocol, or TFTP, provides the system with the bootloader required to continue the installation process.</p>
</div>
<div class="paragraph">
<div class="title">Bootloader</div>
<p>Because the job of booting an operating system is too complex for the pre-boot environment, a bootloader is used to load the kernel and related files. It also provides configuration information to the installer, and can offer a menu to select from different configurations.</p>
</div>
<div class="paragraph">
<div class="title">Kernel and Initramfs</div>
<p>The kernel is the core of any Linux operating system, and the initramfs provides the kernel with required tools and resources. These files are also provided by tftp.</p>
</div>
<div class="paragraph">
<div class="title">Package repository</div>
<p>A Fedora repository must be available for the installation. The example in this section uses the public Fedora mirrors as the repository source, but you can also use a repo on the local network provided by NFS, FTP, or HTTP. Repositories can be configured using the <span class="option">inst.repo=</span> boot option; see <a href="Boot_Options.html#sect-boot-options-sources" class="page">Specifying the Installation Source</a> for details.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-dhcpd"><a class="anchor" href="#pxe-dhcpd"></a>DHCP Server Configuration</h2>
<div class="sectionbody">
<div class="olist arabic">
<div class="title">Installing and configuring dhcpd</div>
<ol class="arabic">
<li>
<p>Install the dhcp server package.</p>
<div class="listingblock">
<div class="content">
<pre># dnf install dhcp</pre>
</div>
</div>
</li>
<li>
<p>Create a simple configuration for the dhcp server at <code>/etc/dhcp/dhcpd.conf</code></p>
<div class="listingblock">
<div class="content">
<pre>subnet 192.168.1.0 netmask 255.255.255.0 {
authoritative;
default-lease-time 600;
max-lease-time 7200;
ddns-update-style none;

option domain-name-servers 192.168.1.1;
option routers 192.168.1.1;

}</pre>
</div>
</div>
</li>
<li>
<p>Test your configuration and address any problems you discover.</p>
<div class="listingblock">
<div class="content">
<pre><span class="command">systemctl start dhcpd</span>
<span class="command">journalctl --unit dhcpd --since -2m --follow</span></pre>
</div>
</div>
</li>
<li>
<p>Add entries to point clients to their bootloader and the server that provides it to your subnet configuration in <code>/etc/dhcp/dhcpd.conf</code>. Because DHCP clients provide the server with identifying information along with their address request, BIOS clients and UEFI clients can each be directed to the correct bootloader.</p>
<div class="listingblock">
<div class="content">
<pre># refer to RFC4578 for possible arch option values
option arch code 93 = unsigned integer 16;

subnet 192.168.1.0 netmask 255.255.255.0 {
if option arch = 00:07 {
filename "uefi/shim64.efi";
} else {
filename "pxelinux.0";
}

next-server 192.168.1.2;

...</pre>
</div>
</div>
</li>
<li>
<p>Restart the dhcp service to check the configuration and make changes as needed.</p>
<div class="listingblock">
<div class="content">
<pre><span class="command">systemctl restart dhcpd</span>
<span class="command">journalctl --unit dhcpd --since -2m --follow</span></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-tftpd"><a class="anchor" href="#pxe-tftpd"></a>Installing the tftp server</h2>
<div class="sectionbody">
<div class="olist arabic">
<div class="title">Installing the tftp server</div>
<ol class="arabic">
<li>
<p>Install the tftp server package.</p>
<div class="listingblock">
<div class="content">
<pre># dnf install tftp-server</pre>
</div>
</div>
</li>
<li>
<p>Start and enable the <code>tftp socket</code>. <code>systemd</code> will automatically start the <code>tftpd</code> service when required.</p>
<div class="listingblock">
<div class="content">
<pre># <span class="command">systemctl start tftp.socket</span>
# <span class="command">systemctl enable tftp.socket</span></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-bootloader"><a class="anchor" href="#pxe-bootloader"></a>Providing and configuring bootloaders for PXE clients</h2>
<div class="sectionbody">
<div class="olist arabic">
<div class="title">Getting the bootloader files</div>
<ol class="arabic">
<li>
<p>Get the <strong class="package">syslinux</strong> bootloader for BIOS clients.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Install the <strong class="package">syslinux</strong> package.</p>
<div class="listingblock">
<div class="content">
<pre># dnf install syslinux</pre>
</div>
</div>
</li>
<li>
<p>Create a directory for the bootloader files, and make them available there.</p>
<div class="listingblock">
<div class="content">
<pre># <span class="command">mkdir -p <code>/var/lib/tftpboot/pxelinux.cfg</code></span>
# <span class="command">cp <code>/usr/share/syslinux/{pxelinux.0,menu.c32,vesamenu.c32,ldlinux.c32,libcom32.c32,libutil.c32}</code> <code>/var/lib/tftpboot/</code></span></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Get the bootloader files for UEFI systems</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Install the <strong class="package">shim-x64</strong> and <strong class="package">grub2-efi-x64</strong> packages. If your server is a BIOS system, you <strong>must install the packages to a temporary install root</strong>. Installing them directly on a BIOS machine will attempt to configure the system for UEFI booting and cause problems.</p>
<div class="listingblock">
<div class="content">
<pre># dnf install shim-x64 grub2-efi-x64 --installroot=/tmp/fedora --releasever 30</pre>
</div>
</div>
</li>
<li>
<p>Create a directory for the bootloader files, and make them available there.</p>
<div class="listingblock">
<div class="content">
<pre># <span class="command">mkdir -p <code>/var/lib/tftpboot/uefi</code></span>
# <span class="command">cp <code>/tmp/fedora/boot/efi/EFI/fedora/{shimx64.efi,grubx64.efi}</code> <code>/var/lib/tftpboot/uefi/</code></span></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Configuring client bootloaders</div>
<ol class="arabic">
<li>
<p>Create a boot menu for BIOS clients at <code>/var/lib/tftpboot/pxelinux.cfg/default</code>.</p>
<div class="listingblock">
<div class="content">
<pre>default vesamenu.c32
prompt 1
timeout 600

label local
menu label Boot from ^local drive
menu default
localboot 0xffff

label linux
menu label ^Install Fedora 30 64-bit
kernel f30/vmlinuz
append initrd=f30/initrd.img inst.stage2=https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/ ip=dhcp

label server
menu label ^Install Fedora 30 ( Minimal Image )
kernel f30/vmlinuz
append initrd=f30/initrd.img inst.stage2=https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/ ip=dhcp ks=https://example.com/fedora/kickstarts/minimal.ks</pre>
</div>
</div>
</li>
<li>
<p>Create a boot menu for UEFI clients at <code>/var/lib/tftpboot/uefi/grub.cfg</code>.</p>
<div class="listingblock">
<div class="content">
<pre>function load_video {
	insmod efi_gop
	insmod efi_uga
	insmod video_bochs
	insmod video_cirrus
	insmod all_video
}

load_video
set gfxpayload=keep
insmod gzio

menuentry 'Exit this grub' {
        exit
}

menuentry 'Install Fedora 64-bit'  --class fedora --class gnu-linux --class gnu --class os {
	linuxefi f30/vmlinuz ip=dhcp inst.repo=https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/
	initrdefi f30/initrd.img
}

menuentry 'Install Fedora 30 Server'  --class fedora --class gnu-linux --class gnu --class os {
	kernel f30/vmlinuz
	append initrd=f30/initrd.img inst.repo=https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/ ip=dhcp ks=https://git.fedorahosted.org/cgit/spin-kickstarts.git/plain/fedora-install-server.ks?h=f21
}</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-kernel"><a class="anchor" href="#pxe-kernel"></a>Getting the kernel and initrd</h2>
<div class="sectionbody">
<div class="olist arabic">
<div class="title">Downloading the kernel and initrd</div>
<ol class="arabic">
<li>
<p>Create a directory for the files.</p>
<div class="listingblock">
<div class="content">
<pre># <span class="command">mkdir -p <code>/var/lib/tftpboot/f30</code></span></pre>
</div>
</div>
</li>
<li>
<p>Download the kernel.</p>
<div class="listingblock">
<div class="content">
<pre># wget https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/images/pxeboot/vmlinuz -O /var/lib/tftpboot/f30/vmlinuz</pre>
</div>
</div>
</li>
<li>
<p>Download the initrd</p>
<div class="listingblock">
<div class="content">
<pre># wget https://download.fedoraproject.org/pub/fedora/linux/releases/30/Server/x86_64/os/images/pxeboot/initrd.img -O /var/lib/tftpboot/f30/initrd.img</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="pxe-repositories"><a class="anchor" href="#pxe-repositories"></a>Providing repositories</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The examples in this section use the public Fedora mirrors as the package source. For faster installations, installing to many systems, or more isolated environments, you may wish to maintain a local repository.</p>
</div>
<div class="paragraph">
<p>Fedora Infrastructure maintains instructions for a configuring a local mirror at <a href="https://fedoraproject.org/wiki/Infrastructure/Mirroring" class="bare">https://fedoraproject.org/wiki/Infrastructure/Mirroring</a>. The preferred method for providing repositories is via HTTP, and you can refer to the <em class="citetitle">Fedora System Administrator&#8217;s Guide</em>, available at <a href="https://docs.fedoraproject.org/" class="bare">https://docs.fedoraproject.org/</a>, to configure <code>httpd</code>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="sect-install-server-cobbler"><a class="anchor" href="#sect-install-server-cobbler"></a>Advanced network installations with Cobbler</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For more complex environments, Fedora offers the <strong class="package">cobbler</strong> installation server. Tasks like managing kickstart configurations, coordinating repositories, maintaining dns records, dhcp servers, and even puppet manifests are effectively automated by <strong class="package">cobbler</strong>.</p>
</div>
<div class="paragraph">
<p>While levaraging all of the features provided by cobbler can be relatively simple, the full functionality of this powerful tool is too broad to be documented in this guide. The cobbler community provides documentation at <a href="https://cobbler.github.io/" class="bare">https://cobbler.github.io/</a> to accompany the packages in the Fedora repository.</p>
</div>
<div class="paragraph">
<p>Alternatively, you may also be interested in <strong>Foreman</strong>. You can find official documentation as well as downloads on the project website at <a href="https://www.theforeman.org/" class="bare">https://www.theforeman.org/</a>.</p>
</div>
</div>
</div>
</article>
<div id="contributing">
    <p class="contribute">Want to help? <a href="https://docs.fedoraproject.org/en-US/fedora-docs/contributing/">Learn how to contribute to Fedora Docs.</a></p>
</div>  </main>
</div>
<footer class="footer">
  <p>All Fedora Documentation content available under <a href="http://creativecommons.org/licenses/by-sa/3.0/legalcode">CC-BY-SA 3.0</a> or, when specifically noted, under another <a href="https://fedoraproject.org/wiki/Licensing:Main">accepted</a> free and open content license.</p>
  <p>Last build: </p>
</footer>
<script src="../../../../_/js/site.js"></script>
<script src="../../../../_/js/vendor/highlight.js"></script>
<script>hljs.initHighlighting()</script>
  </body>
</html>
